From 1c35f7609f1ca5177c344e18e9cbaac02622e0ca Mon Sep 17 00:00:00 2001
From: Sam Nazarko <email@samnazarko.co.uk>
Date: Fri, 10 Apr 2015 14:21:47 +0100
Subject: [PATCH] [sysfsutils] Make sure terminator is not read in GetString()

Signed-off-by: Sam Nazarko <email@samnazarko.co.uk>
---
 xbmc/utils/SysfsUtils.cpp | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/xbmc/utils/SysfsUtils.cpp b/xbmc/utils/SysfsUtils.cpp
index ca62986..e829b00 100644
--- a/xbmc/utils/SysfsUtils.cpp
+++ b/xbmc/utils/SysfsUtils.cpp
@@ -27,6 +27,10 @@
 #include <fcntl.h>
 #include <string.h>
 
+#ifndef O_TEXT
+#define O_TEXT 0x4000
+#endif
+
 int SysfsUtils::SetString(const std::string& path, const std::string& valstr)
 {
   int fd = open(path.c_str(), O_CREAT | O_RDWR | O_TRUNC, 0644);
@@ -45,7 +49,7 @@ int SysfsUtils::GetString(const std::string& path, std::string& valstr)
   int len;
   char buf[256] = {0};
 
-  int fd = open(path.c_str(), O_RDONLY);
+  int fd = open(path.c_str(), O_RDONLY | O_TEXT);
   if (fd >= 0)
   {
     valstr.clear();
-- 
2.1.0

